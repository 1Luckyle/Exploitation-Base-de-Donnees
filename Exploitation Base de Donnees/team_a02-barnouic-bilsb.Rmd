---
title: "Nutri-Score Data Analysis"
output:
  html_document:
    toc: true
    df_print: paged
  word_document:
    toc: true
  latex_document:
    toc: true
    always_allow_latex: true
  pdf_document: default
---

```{r setup, include=FALSE}
library(dplyr)
library(ggplot2)
library(readr)
library(kableExtra)
library(dplyr)
library(knitr)
library(tidyr)
library(viridis)
library(RColorBrewer)
barnouic <- read.csv("D:/BUT 1a/S2/S2.04/barnouic.csv")
```

# To what extent can we establish a link between the nutriscore (A,B,C,D,E) and the nutritional variables ?

We will study the link between the Nutri-Score and nutritional variables on the range of cereals from the United States.

But first of all, we must understand the different variables and data that will be presented to us, so here is a preamble


## What is the Nutri-Score ?

Nutri-Score is a front-of-pack label that provides information on the nutritional quality of products in simplified form that complements the mandatory nutritional declaration (set by European regulations).

It is based on a scale of 5 colours ranging from dark green through yellow to dark orange.
The colours are associated with letters ranging from A to E to optimize its accessibility and understanding by the consumer.

The nutritional score is distinct from the Nutri-Score:

 The nutritional score uses the nutrients and ingredients within the product that have a significant impact on health to derive an estimate of the nutritional value of the product ranging from higher nutritional value for the lowest scores to lower nutritional value for the highest scores.

 The Nutri-Score is a graphic scale that divides the nutritional score into 5 classes (expressed by a colour and a letter), the purpose being to help the consumer better see, interpret and understand the
nutritional value. The objective is not to separate 'good' foods from 'bad' foods, but rather to use the 5 classes to distinguish foods that are healthier from those that are less healthy from a nutritional point of view. This also helps food producers to decide how to reformulate their products so they can move to a higher score.

Source : https://fr.openfoodfacts.org/nutriscore


## Data presentation

### Colours of the Nutri-Score :
Nutri-Score is a front-end labeling system that classifies foods into five categories based on their nutritional quality. The colors associated with each class are as follows :

     - A: Dark green [#00803d]
     - B: Light green [#86bc25]
     - C: Yellow [#ffcc00]
     - D: Orange [#ef7d00]
     - E: Red [#e63312]

### Macronutrients :
Macronutrients are nutrients required in large quantities in the human diet. Here are the macronutrients included in the data :

     - Proteins [proteins_100g]
     - Carbohydrates [carbohydrates_100g]
     - Lipids [fat_100g / level_fat]

### Additives :
Food additives are substances added to foods with the aim of preserving them, coloring them, flavoring them, etc. Here are the additives included in the data :

     - Salt [salt_100g / level_salt]
     - Sugar [sugar_100g / level_sugar]
     - Saturated fats [saturated_fat_100g / level_saturated_fat]

### Presentation of the entire dataset :

```{r, echo=FALSE}
# Dataset Statistics :
usacereals <- barnouic

summary(usacereals)
```

```{r, echo=FALSE}
library(knitr)
library(kableExtra)

selected_columns <- c("product_name", "brands_tags", "nutriscore_score", 
                      "nutriscore_grade", "proteins_100g", "carbohydrates_100g",
                      "fat_100g", "saturated_fat_100g", "sugars_100g",
                      "salt_100g")

data_table <- usacereals[, selected_columns]

kable(data_table[1:10, ], format = "html", caption = "Exemple with first 10 rows of the dataset") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

The table above provides an overview of key statistics relating to food data recorded by the Nutri-Score system on grain products from the United States. It summarizes the total number of foods listed, the number of distinct brands listed, the average Nutri-Score, as well as the average macronutrient values for the foods listed.


## Analysis

### 1. Bar chart : Comparison of average Nutri-Score by color category (A, B, C, D, E)

We begin our analysis by examining the distribution of the average Nutri-Score by color category. The Nutri-Score classifies food products into five categories from A to E, each associated with a specific color.

```{r, echo=FALSE}
A <- subset(usacereals, nutriscore_grade == "a")
B <- subset(usacereals, nutriscore_grade == "b")
C <- subset(usacereals, nutriscore_grade == "c")
D <- subset(usacereals, nutriscore_grade == "d")
E <- subset(usacereals, nutriscore_grade == "e")

nutriscore_counts <- data.frame(
  Grade = c("A", "B", "C", "D", "E"),
  Count = c(nrow(A), nrow(B), nrow(C), nrow(D), nrow(E))
)

nutriscore_barplot <- ggplot(nutriscore_counts, aes(x = Grade, y = Count)) +
  geom_bar(stat = "identity", fill = c("#00803d", "#86bc25", "#ffcc00", "#ef7d00", "#e63312")) +
  labs(title = "Number of products in each Nutri-Score Grade class",
       x = "Nutri-Score Grade",
       y = "Number of products") +
  theme_minimal()

print(nutriscore_barplot)
```

We see a trend where products with a more favorable Nutri-Score (A and B) tend to have higher average scores, corresponding to green colors, while products with a less favorable Nutri-Score (D and E) have lower average scores, represented by orange and red colors.

Concerning cereals we see that around 4000 products are rated A compared to between 500 to 1500 products for grades B to E.

### 2. Bar chart : Exploring average Macronutrients and Additives content across Nutri-Score categories (A, B, C, D, E)

Visualizing data through graphs is an essential aspect of data analysis, providing insights into trends, patterns, and relationships within the dataset. In this analysis, we explore the nutritional composition of cereals categorized by their Nutri-Score grades. Nutri-Score categorizes food products based on their nutritional quality, ranging from "A" (healthier) to "E" (less healthy).

```{r, echo=FALSE}
calculate_average_nutrient <- function(category, nutrient_variable) {
  products_category <- subset(usacereals, nutriscore_grade == category)
  
  nutrient_values <- as.numeric(products_category[[nutrient_variable]][
    !is.na(products_category[[nutrient_variable]]) & 
    grepl("^\\d+\\.?\\d*$", products_category[[nutrient_variable]])])
  
  average_nutrient_percentage <- mean(nutrient_values)
  
  return(average_nutrient_percentage)
}

macronutrients <- c("proteins_100g", "carbohydrates_100g", "fat_100g", "sodium_100g")

additives <- c("sugars_100g", "salt_100g", "saturated_fat_100g")

average_macronutrient_percentages <- list()
average_additive_percentages <- list()

for (variable in macronutrients) {
  average_macronutrient_percentages[[variable]] <- numeric()
  for (category in c("a", "b", "c", "d", "e")) {
    average_macronutrient_percentages[[variable]] <- c(
      average_macronutrient_percentages[[variable]], 
      calculate_average_nutrient(category, variable))
  }
}

for (variable in additives) {
  average_additive_percentages[[variable]] <- numeric()
  for (category in c("a", "b", "c", "d", "e")) {
    average_additive_percentages[[variable]] <- c(
      average_additive_percentages[[variable]], 
      calculate_average_nutrient(category, variable))
  }
}

macronutrients_data <- data.frame(Category = rep(c("a", "b", "c", "d", "e"), length(macronutrients)),
                                  Nutrient = rep(macronutrients, each = 5),
                                  Average_Percentage = unlist(average_macronutrient_percentages))

additives_data <- data.frame(Category = rep(c("a", "b", "c", "d", "e"), length(additives)),
                             Nutrient = rep(additives, each = 5),
                             Average_Percentage = unlist(average_additive_percentages))

macronutrients_barplot <- ggplot(macronutrients_data, aes(x = Category, y = Average_Percentage, fill = Nutrient)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Average Macronutrient Percentage for Each Nutri-Score Category from A to E",
       x = "Nutri-Score Category",
       y = "Average Macronutrient Percentage") +
  scale_fill_manual(values = c("#FF6347", "#4169E1", "#32CD32", "#8A2BE2")) +
  theme_minimal()

additives_barplot <- ggplot(additives_data, aes(x = Category, y = Average_Percentage, fill = Nutrient)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Average Additive Percentage for Each Nutri-Score Category from A to E",
       x = "Nutri-Score Category",
       y = "Average Additive Percentage") +
  scale_fill_manual(values = c("#FFD700", "#FFA500", "#FF1493")) +
  theme_minimal()

print(macronutrients_barplot)
print(additives_barplot)
```

 Macronutrients Composition: The analysis reveals that cereals, on average, consist of approximately 58% to 67% carbohydrates across different Nutri-Score categories. Carbohydrates serve as the primary energy source in cereals and are expected to form a significant portion of their composition.

 Sodium Content: Both sodium and salt content are minimal and vary slightly across Nutri-Score categories. This indicates that cereals generally contain low levels of sodium, which is consistent with their classification as processed foods with limited added salt.

 Proteins: Interestingly, there is a noticeable decrease in protein content as the Nutri-Score grade declines. Cereals with lower Nutri-Scores tend to have lower protein levels. This finding suggests that healthier cereals, categorized with higher Nutri-Scores, may contain more protein-rich ingredients.

 Sugars: The analysis highlights a significant increase in sugar content in cereals with lower Nutri-Score grades. Cereals categorized as less healthy (closer to "E" on the Nutri-Score scale) tend to have higher sugar levels. This observation underscores the importance of monitoring sugar intake, especially in processed foods like cereals.

 Saturated Fat and Fat Content: Similar to sugars, there is a substantial increase in saturated fat and overall fat content in cereals with lower Nutri-Score grades. This trend indicates that less healthy cereals often contain higher levels of unhealthy fats, which can contribute to various health issues if consumed excessively.

In conclusion, the analysis of cereals' nutritional composition based on Nutri-Score categories reveals notable trends in macronutrient distribution. While carbohydrates dominate cereals' composition across all Nutri-Score grades, there are significant variations in other nutrients. The findings emphasize the importance of making informed choices when selecting cereals, considering factors such as protein content, sugar levels, and fat composition, to promote healthier dietary habits. By leveraging visualizations like graphs, we can gain valuable insights into nutritional patterns and make more informed decisions to support overall health and well-being.

### 3. Bars charts : The different levels of additives in cereal compositions

The presented series of graphs offers a comprehensive insight into the nutritional levels across different categories of the Nutri-Score, focusing on saturated fat, sugars, salt, and overall fat content. The Nutri-Score grading system, ranging from A to E, serves as a crucial tool in evaluating the nutritional quality of food products, aiding consumers in making informed dietary choices. Through these visualizations, we aim to explore the variations in nutritional composition across different Nutri-Score categories and highlight patterns that can guide healthier food selections.

```{r, echo=FALSE}
usacereals <- subset(usacereals, nutriscore_grade %in% c('a', 'b', 'c', 'd', 'e'))

usacereals$level_saturated_fat <- ifelse(usacereals$level_saturated_fat %in% c('l', 'm', 'h'), 
                                         usacereals$level_saturated_fat, 'unknown')

usacereals$level_sugars <- ifelse(usacereals$level_sugars %in% c('l', 'm', 'h'), 
                                  usacereals$level_sugars, 'unknown')

usacereals$level_salt <- ifelse(usacereals$level_salt %in% c('l', 'm', 'h'), 
                                usacereals$level_salt, 'unknown')

usacereals$level_fat <- ifelse(usacereals$level_fat %in% c('l', 'm', 'h'), 
                               usacereals$level_fat, 'unknown')

combined_data <- rbind(
  data.frame(nutriscore_grade = usacereals$nutriscore_grade, variable = "Saturated Fat", level = usacereals$level_saturated_fat),
  data.frame(nutriscore_grade = usacereals$nutriscore_grade, variable = "Sugars", level = usacereals$level_sugars),
  data.frame(nutriscore_grade = usacereals$nutriscore_grade, variable = "Salt", level = usacereals$level_salt),
  data.frame(nutriscore_grade = usacereals$nutriscore_grade, variable = "Fat", level = usacereals$level_fat)
)

combined_barplot <- ggplot(combined_data, aes(x = nutriscore_grade, fill = level)) +
  geom_bar(position = "fill") +
  facet_wrap(~variable, scales = "free") +
  labs(title = "Distribution of Nutritional Levels by Nutri-Score Category",
       x = "Nutri-Score Category",
       y = "Proportion of Products") +
  scale_fill_manual(values = c("l" = "#00803d", "m" = "#86bc25", "h" = "#e63312", "unknown" = "grey")) +
  theme_minimal()

print(combined_barplot)
```

The observed trends in the distribution of nutritional levels underscore the effectiveness of the Nutri-Score system in discerning the nutritional quality of food items. Particularly striking is the evident contrast between categories A to C and categories D to E, wherein the latter exhibit substantially higher levels of sugars and saturated fat. This distinction emphasizes the importance of opting for products falling within the A to C range for healthier dietary practices. Moreover, the prevalence of elevated fat and salt levels in categories D and E, coupled with their significant reduction in categories A to C, underscores the pivotal role of Nutri-Score in steering consumers towards more balanced and nutritious food options. As such, these findings underscore the utility of the Nutri-Score in promoting healthier eating habits and fostering greater awareness regarding the nutritional content of food products.

## Conclusion

After an in-depth analysis of the data relating to the Nutri-Score and the nutritional variables of products in the 'cereal' family in the United States, here is a more detailed presentation of the conclusions:

1. **Correlation between the Nutri-Score and nutritional variables:**
    - We observed a significant correlation between the Nutri-Score and various nutritional variables such as proteins, carbohydrates, lipids, saturated fats, sugar and salt.
    - Products classified with a more favorable Nutri-Score (A or B) tend to have lower values of saturated fat, sugar and salt.
    - On the other hand, products with a lower Nutri-Score (D or E) often have higher levels of these nutrients potentially harmful to health.

2. **Impact on health:**
    - The Nutri-Score offers a valuable indication of the nutritional quality of foods.
    - Products with a higher Nutri-Score (A or B) are generally considered more nutritionally healthy, as they are often higher in protein, fiber, and contain less saturated fat, sugar and salt .
    - On the other hand, products with a lower Nutri-Score (D or E) are likely to present less favorable values in terms of nutrition, with higher levels of nutrients potentially harmful to health.

3. **Usefulness for consumers:**
    - The Nutri-Score provides valuable and easily understandable information for consumers, allowing them to make informed dietary decisions.
    - By evaluating the nutritional quality of food products, the Nutri-Score helps consumers choose healthier foods and promote a balanced diet.

In conclusion, the Nutri-Score represents an essential tool in promoting healthier food choices. Based on Nutrition Facts Table and ingredient data, it provides consumers with a clear indication of the nutritional quality of food products, helping them adopt eating habits that are more beneficial to their overall health.
